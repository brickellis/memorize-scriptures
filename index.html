<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flashcard Study App</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="data:,">
    <script src="script.js"></script>
</head>

<body>
    <div class="container">
        <h1>Flashcard Study App</h1>
        <div id="selection-screen" class="screen active">
            <div class="selection-controls">
                <div class="shuffle-toggle">
                    <input type="checkbox" id="shuffle-toggle">
                    <label for="shuffle-toggle">Shuffle</label>
                </div>
                <div class="range-controls">
                    <div class="range-inputs">
                        <label for="start-index">Start:</label>
                        <input type="number" id="start-index" min="1" value="1">
                        <label for="stop-index">Stop:</label>
                        <input type="number" id="stop-index" min="1" value="">
                        <label for="skip-interval">Skip:</label>
                        <input type="number" id="skip-interval" min="1" value="1">
                    </div>
                </div>
                <button id="start-btn" class="btn" onclick="startSession()" disabled>Start Session</button>
                <button class="btn secondary" onclick="selectAll()">Select All</button>
                <button class="btn secondary" onclick="clearAll()">Clear All</button>
            </div>
            <div id="selection-tree" class="selection-tree"></div>
            <div id="error-msg" class="error"></div>
        </div>
        <div id="session-screen" class="screen">
            <div class="session-header">
                <div id="progress" class="progress">Card 1 of 10</div>
                <button class="btn secondary" onclick="restartSession()">Restart</button>
            </div>
            <div class="card-container">
                <div id="flashcard" class="flashcard" onclick="flipCard()">
                    <div id="card-front" class="card-side active">
                        <div class="card-content"></div>
                    </div>
                    <div id="card-back" class="card-side">
                        <div class="card-content"></div>
                    </div>
                </div>
            </div>
        </div>
        <div id="results-screen" class="screen">
            <div class="results">
                <h2>Session Complete!</h2>
                <div class="stats">
                    <div class="stat-item">
                        <div id="known-count" class="stat-number">0</div>
                        <div class="stat-label">Cards Mastered</div>
                    </div>
                    <div class="stat-item">
                        <div id="unknown-count" class="stat-number">0</div>
                        <div class="stat-label">Cards to Review</div>
                    </div>
                    <div class="stat-item">
                        <div id="session-time" class="stat-number">0m</div>
                        <div class="stat-label">Study Time</div>
                    </div>
                </div>
                <div>
                    <button id="continue-btn" class="btn" onclick="continueWithMissed()" style="display: none;">Continue
                        with Missed Cards</button>
                    <button class="btn secondary" onclick="backToSelection()">New Session</button>
                    <button class="btn secondary" onclick="restartSession()">Restart</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        let flashcardData = null;
        let sessionState = {
            selectedCards: [],
            remainingCards: [],
            knownCards: [],
            unknownCards: [],
            isFlipped: false,
            sessionActive: false,
            startTime: null,
            shuffleEnabled: false
        };

        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('shuffle-toggle').checked = sessionState.shuffleEnabled;
            document.getElementById('shuffle-toggle').addEventListener('change', function () {
                sessionState.shuffleEnabled = this.checked;
            });
            setupEventListeners();
            loadFlashcardsFromGitHub();
        });

        function renderSelectionTree() {
            const tree = document.getElementById('selection-tree');
            tree.innerHTML = '';
            tree.style.display = 'block';

            for (const [categoryId, category] of Object.entries(flashcardData.categories)) {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';

                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';

                const categoryCheckbox = document.createElement('div');
                categoryCheckbox.className = 'checkbox-item';
                categoryCheckbox.innerHTML = `
                    <input type="checkbox" id="cat-${categoryId}" onchange="toggleCategory('${categoryId}')">
                    <label for="cat-${categoryId}">${category.name}</label>
                    <span class="card-count">(${getTotalCards(category)} cards)</span>
                `;

                categoryHeader.appendChild(categoryCheckbox);
                categoryDiv.appendChild(categoryHeader);

                if (category.subcategories) {
                    for (const [subId, subcategory] of Object.entries(category.subcategories)) {
                        const subDiv = document.createElement('div');
                        subDiv.className = 'subcategory';
                        subDiv.innerHTML = `
                            <div class="checkbox-item">
                                <input type="checkbox" id="sub-${categoryId}-${subId}" onchange="updateSelectionCount()">
                                <label for="sub-${categoryId}-${subId}">${subcategory.name}</label>
                                <span class="card-count">(${subcategory.cards ? subcategory.cards.length : 0} cards)</span>
                            </div>
                        `;
                        categoryDiv.appendChild(subDiv);
                    }
                }
                tree.appendChild(categoryDiv);
            }
        }

        function startSession() {
            const selectedCards = [];
            const startIndex = parseInt(document.getElementById('start-index').value) || 1;
            const stopIndex = parseInt(document.getElementById('stop-index').value);
            const skipInterval = parseInt(document.getElementById('skip-interval').value) || 1;

            if (stopIndex && startIndex > stopIndex) {
                showError('Please enter valid start and stop indices (start must be â‰¤ stop)');
                return;
            }
            if (startIndex < 1 || skipInterval < 1) {
                showError('Start index and skip interval must be at least 1');
                return;
            }

            for (const [categoryId, category] of Object.entries(flashcardData.categories)) {
                if (category.subcategories) {
                    for (const [subId, subcategory] of Object.entries(category.subcategories)) {
                        const checkbox = document.getElementById(`sub-${categoryId}-${subId}`);
                        if (checkbox && checkbox.checked && subcategory.cards) {
                            const rangeCards = getCardsWithRange(subcategory.cards, startIndex, stopIndex, skipInterval);
                            selectedCards.push(...rangeCards);
                        }
                    }
                }
            }

            if (selectedCards.length === 0) {
                showError('Please select at least one category');
                return;
            }

            sessionState.selectedCards = selectedCards;

            setSessionState();
            showScreen('session-screen');
            displayCurrentCard();
        }

    </script>
</body>
</html>